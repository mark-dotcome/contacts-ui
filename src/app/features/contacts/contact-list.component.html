<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="p-2 md:p-4">
  <div class="flex flex-column md:flex-row justify-content-between align-items-start md:align-items-center mb-4 gap-3">
    <div>
      <h1 class="text-2xl md:text-3xl font-bold text-900 m-0">Contacts</h1>
      <p class="text-600 mt-1">Manage your contact list</p>
    </div>
    <p-button 
      label="Add Contact" 
      icon="pi pi-plus" 
      (onClick)="navigateToCreate()"
      class="w-full md:w-auto"
    ></p-button>
  </div>

  <p-card>
    <div class="mb-4">
      <p-inputgroup>
        <p-inputgroup-addon>
          <i class="pi pi-search"></i>
        </p-inputgroup-addon>
        <input 
          type="text" 
          pInputText 
          [(ngModel)]="searchQuery"
          (input)="onSearch()"
          placeholder="Search by name, email, phone, or address..." 
          class="w-full"
        />
        @if (searchQuery) {
          <p-inputgroup-addon>
            <p-button 
              icon="pi pi-times" 
              [text]="true" 
              [rounded]="true"
              severity="secondary"
              (onClick)="clearSearch()"
              pTooltip="Clear search"
            ></p-button>
          </p-inputgroup-addon>
        }
      </p-inputgroup>
    </div>

    <p-table 
      [value]="contacts" 
      [paginator]="true" 
      [rows]="10"
      [totalRecords]="totalRecords"
      [lazy]="true"
      (onLazyLoad)="loadContacts($event)"
      [loading]="loading"
      [rowHover]="true"
      styleClass="p-datatable-sm"
      responsiveLayout="scroll"
      [breakpoint]="'768px'"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="lastName">Name <p-sortIcon field="lastName"></p-sortIcon></th>
          <th>Phone</th>
          <th>Address</th>
          <th>App</th>
          <th>Modified</th>
          <th style="width: 150px">Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-contact>
        <tr>
          <td>
            <div class="flex align-items-center gap-2">
              <div class="flex align-items-center justify-content-center bg-primary border-circle" style="width: 40px; height: 40px;">
                <span class="text-white font-bold">{{ getInitials(contact) }}</span>
              </div>
              <div>
                <div class="font-bold">{{ contact.firstName }} {{ contact.lastName }}</div>
                <div class="text-600 text-sm">{{ contact.email }}</div>
              </div>
            </div>
          </td>
          <td>{{ contact.phone }}</td>
          <td>{{ formatAddress(contact.address) }}</td>
          <td><p-tag [value]="contact.app" severity="info"></p-tag></td>
          <td>{{ formatDate(contact.modifiedDt) }}</td>
          <td>
            <div class="flex gap-2">
              <p-button 
                icon="pi pi-eye" 
                [rounded]="true" 
                [text]="true"
                (onClick)="viewContact(contact)"
              ></p-button>
              <p-button 
                icon="pi pi-pencil" 
                [rounded]="true" 
                [text]="true"
                (onClick)="editContact(contact)"
              ></p-button>
              <p-button 
                icon="pi pi-trash" 
                [rounded]="true" 
                [text]="true"
                severity="danger"
                (onClick)="confirmDelete(contact)"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center p-4">
            <i class="pi pi-inbox text-4xl text-400 mb-3"></i>
            <p class="text-600">No contacts found</p>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>
